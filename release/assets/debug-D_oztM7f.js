import{j as e,r as c}from"./vendor-BcNuLXi4.js";const ms="gemini-flash-latest",hs="gemini-2.5-pro",ps="gemini-flash-lite-latest",ds="gemma-3-27b-it",us="gemma-3n-e4b-it",q="```",gs=.8,xs=10,fs=15,vs=30,js=30,oe=["Fantasy & Myth","Science Fiction & Future","Horror & Dark Mystery","Action & Wasteland","Testing"],bs=3,Ss=3,ws=50,Is="Eliot the Cougar",Cs="1.5.1 (Backstory)",ys="10",Ts="whispersInTheDark_gameState",_s="whispersInTheDark_debugPacket",Es="whispersInTheDark_debugLore",Ns="whispersInTheDark_geminiApiKey",Ls="whispersInTheDark_settings",As=oe.filter(s=>s!=="Testing"),Rs="player",Ds="player_journal",Ms="universe",Os=6,ks=70,$s=2,Us=5,Gs=3,zs=3,Js=2,Hs=1,Fs=5,Vs=10,qs=10,Bs=4,Ws=10,K=["page","book","picture","map"],Ys=["picture","map"],Xs=["page","picture","map"],Ks=K.map(s=>s).join(", "),P=["single-use","multi-use","equipment","container","key","weapon","ammunition","vehicle","immovable","status effect"],Ps=P.map(s=>s).join(", "),ie=[...P,...K],Zs=ie.map(s=>s).join(", "),le=["create","change","move","destroy","addDetails"],Qs=le.map(s=>s).join(", "),Z=["default","junk"],ce=["stashed"],_=["printed","handwritten","typed","digital"],me=["faded","smudged","torn","glitching","encrypted","foreign","gothic","runic","recovered"],H=[..._,...me],he=[...Z,...ce,...H],et=Z.map(s=>s).join(", "),st=_.map(s=>s).join(", "),tt=H.map(s=>s).join(", ");he.map(s=>s).join(", ");const pe=["inspect","use","drop","discard","enter","park","read","write"],nt=pe.map(s=>s).join(", "),de=["distant","nearby","companion","unknown"],at=["nearby","companion"],rt=["distant","unknown"],ot=de.map(s=>s).join(", "),it="neutral",lt={1:"exposition - Introduces the setting, central characters, and the primary conflict of the tale.",2:"rising action - Tension and complications mount as the protagonist pursues their goal.",3:"climax - The story reaches a turning point where the protagonist confronts the core challenge.",4:"falling action - The immediate consequences of the climax unfold and loose ends are addressed.",5:"resolution - Conflicts resolve and the narrative ties up remaining threads for closure."},ct={initial_load:{text:"Loading...",icon:"░"},storyteller:{text:"Dungeon Master thinks...",icon:"░"},loremaster_collect:{text:"Loremaster picks relevant facts...",icon:"░"},loremaster_extract:{text:"Loremaster extracts new lore...",icon:"░"},loremaster_integrate:{text:"Loremaster adds relevant lore...",icon:"░"},loremaster_distill:{text:"Loremaster distills the lore...",icon:"░"},map_updates:{text:"Cartographer draws the map...",icon:"░"},corrections:{text:"Dungeon Master is fixing mistakes...",icon:"▓"},inventory_updates:{text:"Dungeon Master handles items...",icon:"░"},librarian_updates:{text:"Dungeon Master handles books...",icon:"░"},dialogue_turn:{text:"Conversation continues...",icon:"░"},dialogue_summary:{text:"Dialogue concludes...",icon:"░"},dialogue_memory:{text:"Memories form...",icon:"░"},visualize_scene:{text:"Visualizing the scene...",icon:"░"},read_page:{text:"Reading...",icon:"░"},write_journal:{text:"Writing...",icon:"░"},read_book:{text:"Reading...",icon:"░"}},ue=["undiscovered","discovered","rumored","quest_target","blocked"],mt=ue.map(s=>s).join(", "),Q=["region","location","settlement","district","exterior","interior","room","feature"],ht=Q.map(s=>s).join(", "),pt=Q.reduce((s,t,o)=>(s[t]=o,s),{}),ge=["path","road","sea route","door","teleporter","secret_passage","river_crossing","temporary_bridge","boarding_hook","shortcut"],dt=ge.map(s=>s).join(", "),xe=["open","accessible","closed","locked","blocked","hidden","rumored","one_way","collapsed","removed","active","inactive"],ut=xe.map(s=>s).join(", "),gt=["collapsed","hidden","removed"],xt=20,B=1e3,W=750,ft=`${String(-B/2)} ${String(-W/2)} ${String(B)} ${String(W)}`,vt=8,jt=4,bt=10,St=1.1,wt=2,It=.3,Ct=5,yt=4,Tt=8,_t=10,Et="a short creative description of the location, <300 chars",Nt="a short creative description, focusing of travel conditions of the path",Lt="alternative names, partial names, shorthands. Avoid generic common terms.";function F(s){const t=globalThis;return typeof t.structuredClone=="function"?t.structuredClone(s):z(s)}function Y(s){const t=F(s);return t.inventory=t.inventory.map(o=>{var n;return{...o,chapters:(n=o.chapters)==null?void 0:n.map(a=>({...a,imageData:void 0}))}}),t.playerJournal=t.playerJournal.map(o=>({...o,imageData:void 0})),t}function z(s){if(s===null||typeof s!="object")return s;if(s instanceof Date)return new Date(s.getTime());if(Array.isArray(s))return s.map(o=>z(o));const t={};for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=z(s[o]));return t}const fe=new RegExp(String.raw`^${q}(?:json)?\s*\n?(.*?)\n?\s*${q}$`,"s"),ee=s=>{let t=s.trim();const o=fe.exec(t);return o!=null&&o[1]&&(t=o[1].trim()),t};function se(s,t){try{const o=ee(s),n=JSON.parse(o);return t&&!t(n)?null:n}catch{return null}}function At(s){return Object.fromEntries(Object.entries(s).map(([o,n])=>[o,n===null?void 0:n]))}const N=s=>{const t=[];return s.minItems!==void 0&&t.push(`minItems ${String(s.minItems)}`),s.maxItems!==void 0&&t.push(`maxItems ${String(s.maxItems)}`),s.minLength!==void 0&&t.push(`minLength ${String(s.minLength)}`),s.maxLength!==void 0&&t.push(`maxLength ${String(s.maxLength)}`),s.description&&t.push(s.description),t.length?` /* ${t.join(". ")} */`:""},J=(s,t=0)=>{const o="  ".repeat(t);if(s.type==="object"||s.properties){const n=[`${o}{`],a=s.properties??{},l=new Set(s.required??[]),r=Object.keys(a);return r.forEach((m,d)=>{const h=J(a[m],t+1),j=h[0].trim().startsWith("{")||h[0].trim().startsWith("[");h[0]=j?`${o}  "${m}"${l.has(m)?"":"?"}:
${h[0]}`:`${o}  "${m}"${l.has(m)?"":"?"}: ${h[0]}`;const f=d<r.length-1?",":"";h[h.length-1]+=f,n.push(...h)}),n.push(`${o}}${N(s)}`),n}if(s.type==="array"||s.items){const n=[`${o}[`],a=J(s.items??{},t+1);return n.push(...a),n.push(`${o}]${N(s)}`),n}return s.enum?[`${s.enum.map(a=>JSON.stringify(a)).join(" | ")}${N(s)}`]:s.const!==void 0?[`${JSON.stringify(s.const)}${N(s)}`]:s.type?[`"${s.type==="integer"?"number":s.type}"${N(s)}`]:[`unknown${N(s)}`]},ve=s=>J(s).join(`
`),L=s=>{const o=(typeof s=="string"?se(s):s)??{};return`Respond ONLY with a JSON with the following schema:
${ve(o)}`},je=(s,t)=>{const o=document.querySelector(".highlight-tooltip");o&&o.remove();const n=document.createElement("div");n.className="highlight-tooltip",n.textContent=s,document.body.appendChild(n);const a=8,l=t.left+t.width/2-n.offsetWidth/2+window.scrollX,r=t.bottom+a+window.scrollY;n.style.left=`${String(Math.max(4,Math.min(l,window.innerWidth-n.offsetWidth-4)))}px`,n.style.top=`${String(r)}px`;const m=()=>{n.remove(),document.removeEventListener("click",d)},d=h=>{n.contains(h.target)||m()};setTimeout(()=>{document.addEventListener("click",d)},0)};let O=null;const be=s=>{const t=JSON.stringify(s.map(r=>({name:r.name,aliases:r.aliases??[],type:r.type})).sort((r,m)=>r.name.localeCompare(m.name)));if(O&&O.key===t)return O.value;const o=new Map;s.forEach(r=>{const m=(h,j)=>{if(h&&h.trim()!==""){const f=h.toLowerCase();o.has(f)||o.set(f,{term:j,entityData:r})}};m(r.name,r.name),(r.aliases??[]).forEach(h=>{m(h,h)});const d=r.name.toLowerCase();if(d.startsWith("the ")&&r.name.length>4){const h=r.name.substring(4);m(h,h)}else if(d.startsWith("a ")&&r.name.length>2){const h=r.name.substring(2);m(h,h)}});const n=Array.from(o.values());if(n.sort((r,m)=>m.term.length-r.term.length),n.length===0)return null;const a=n.map(r=>r.term.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).filter(r=>r.length>0).join("|");if(!a)return null;const l={regex:new RegExp(`\\b(${a})\\b`,"gi"),lookup:new Map(n.map(r=>[r.term.toLowerCase(),r]))};return O={key:t,value:l},l},Se=s=>{switch(s){case"item":return"font-semibold text-amber-400 hover:text-amber-300 cursor-pointer";case"place":return"font-semibold text-violet-400 hover:text-violet-300 cursor-pointer";case"npc":return"font-semibold text-green-300 hover:text-green-200 cursor-pointer";default:return""}},we=(s,t,o=!1)=>{if(!s)return[s??""];const n=be(t);if(!n)return[s];const{regex:a,lookup:l}=n,r=[];let m=0,d;for(;(d=a.exec(s))!==null;){const h=d[0],j=l.get(h.toLowerCase());if(d.index>m&&r.push(s.substring(m,d.index)),j){const f=v=>{if(window.matchMedia("(hover: none)").matches){const x=v.currentTarget.getBoundingClientRect(),g=v.currentTarget.getAttribute("title")??"";je(g,x)}};r.push(e.jsx("span",{className:Se(j.entityData.type),onClick:o?f:void 0,title:j.entityData.description,children:h},`${j.entityData.name}-${j.term}-${String(d.index)}`))}else r.push(h);m=a.lastIndex}return m<s.length&&r.push(s.substring(m)),r.length>0?r:[s]},Rt=(s,t,o)=>{const n=s.map(r=>({name:r.name,type:"item",description:r.isActive&&r.activeDescription?r.activeDescription:r.description,item:r})),a=t.map(r=>({name:r.placeName,type:"place",description:r.description,aliases:r.aliases??[]})),l=o.map(r=>({name:r.name,type:"npc",description:r.description,aliases:r.aliases}));return[...n,...a,...l]},Ie=["standard","center","compact","toolbar","toolbarLarge","toggle","toggleFull","close","tab"],Ce=["slate","gray","zinc","neutral","stone","red","orange","amber","yellow","lime","green","emerald","teal","cyan","sky","blue","indigo","violet","purple","fuchsia","pink","rose"];function p({ariaLabel:s,onClick:t,disabled:o=!1,icon:n,label:a,highlightEntities:l,enableHighlightTap:r=!1,pressed:m=!1,size:d="md",title:h,type:j="button",variant:f="standard",preset:v,cost:x,"data-action-name":g,"data-item-id":u,"data-item-name":b,"data-node-id":I,"data-option":y,"data-prompt-effect":w}){const E=c.useCallback(M=>{t(M),M.currentTarget.blur()},[t]),R=f==="standard"||f==="center"||f==="compact"||f==="toggleFull"?{sm:"px-3 py-1 text-sm",md:"px-3 py-2 text-base",lg:"px-3 py-3 text-lg"}[d]:"",$={standard:"w-full flex items-center justify-center",center:"w-full flex items-center text-center",compact:"inline-flex items-center justify-center",toolbar:"flex items-center justify-center w-9 h-9 p-2",toolbarLarge:"flex items-center justify-center w-[4.33rem] h-[4.33rem] p-3",toggle:"inline-flex items-center justify-center px-3 py-1 text-xs",toggleFull:"w-full flex items-center justify-center",close:"animated-frame-close-button",tab:"px-3 py-2 text-sm font-medium transition-colors"},U={slate:"bg-slate-600 hover:bg-slate-500 focus:ring-slate-400",gray:"bg-gray-700 hover:bg-gray-500 focus:ring-gray-400",zinc:"bg-zinc-700 hover:bg-zinc-500 focus:ring-zinc-400",neutral:"bg-neutral-700 hover:bg-neutral-500 focus:ring-neutral-400",stone:"bg-stone-700 hover:bg-stone-500 focus:ring-stone-400",red:"bg-red-700 hover:bg-red-500 focus:ring-red-400",orange:"bg-orange-700 hover:bg-orange-500 focus:ring-orange-400",amber:"bg-amber-700 hover:bg-amber-500 focus:ring-amber-400",yellow:"bg-yellow-700 hover:bg-yellow-500 focus:ring-yellow-400",lime:"bg-lime-700 hover:bg-lime-500 focus:ring-lime-400",green:"bg-green-700 hover:bg-green-500 focus:ring-green-400",emerald:"bg-emerald-700 hover:bg-emerald-500 focus:ring-emerald-400",teal:"bg-teal-700 hover:bg-teal-500 focus:ring-teal-400",cyan:"bg-cyan-700 hover:bg-cyan-500 focus:ring-cyan-400",sky:"bg-sky-700 hover:bg-sky-500 focus:ring-sky-400",blue:"bg-blue-700 hover:bg-blue-500 focus:ring-blue-400",indigo:"bg-indigo-700 hover:bg-indigo-500 focus:ring-indigo-400",violet:"bg-violet-700 hover:bg-violet-500 focus:ring-violet-400",purple:"bg-purple-700 hover:bg-purple-500 focus:ring-purple-400",fuchsia:"bg-fuchsia-700 hover:bg-fuchsia-500 focus:ring-fuchsia-400",pink:"bg-pink-700 hover:bg-pink-500 focus:ring-pink-400",rose:"bg-rose-700 hover:bg-rose-500 focus:ring-rose-400"},S=(f==="toggle"||f==="toggleFull")&&m?"ring-2 ring-sky-400 ring-offset-1 ring-offset-slate-800":f==="tab"?m?"border-b-2 border-sky-400 text-sky-300":"text-slate-300 hover:text-sky-400 border-b-2 border-transparent":"",D=l&&typeof a=="string"?we(a,l,r):a;return e.jsxs("button",{"aria-label":s,"aria-pressed":f==="toggle"||f==="toggleFull"?m:void 0,className:`rounded-md shadow transition-colors duration-150 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 ${R} ${$[f]} ${v?U[v]:""} ${S} ${x!==void 0?"relative":""}`,"data-action-name":g,"data-item-id":u,"data-item-name":b,"data-node-id":I,"data-option":y,"data-prompt-effect":w,disabled:o,onClick:E,title:h,type:j==="submit"?"submit":j==="reset"?"reset":"button",children:[n?e.jsx("span",{className:a?"mr-2 inline-flex":"inline-flex",children:n}):null,D?e.jsx("span",{className:"flex-1 text-shadow-sm text-center",children:D}):null,x!==void 0?e.jsx("span",{className:"absolute right-2 text-xs",children:x}):null]})}p.defaultProps={"data-action-name":void 0,"data-item-id":void 0,"data-item-name":void 0,"data-node-id":void 0,"data-option":void 0,"data-prompt-effect":void 0,cost:void 0,disabled:!1,enableHighlightTap:!1,highlightEntities:void 0,icon:void 0,label:void 0,preset:void 0,pressed:!1,size:"md",title:void 0,type:"button",variant:"standard"};function ye({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18ZM12 8.25l3 3.75-3 3.75-3-3.75 3-3.75Z",strokeLinecap:"round",strokeLinejoin:"round"})})}function Te({height:s="1em",width:t="1em"}){return e.jsxs("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M2.036 12.322a1 1 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0",strokeLinecap:"round",strokeLinejoin:"round"})]})}function _e({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ee({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ne({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0m-9-3.75h.008v.008H12z",strokeLinecap:"round",strokeLinejoin:"round"})})}function Le({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ae({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z",strokeLinecap:"round",strokeLinejoin:"round"})})}function Re({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 0 0 .75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 0 0-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0 1 12 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 0 1-.673-.38m0 0A2.18 2.18 0 0 1 3 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 0 1 3.413-.387m7.5 0V5.25A2.25 2.25 0 0 0 13.5 3h-3a2.25 2.25 0 0 0-2.25 2.25v.894m7.5 0a48.667 48.667 0 0 0-7.5 0M12 12.75h.008v.008H12v-.008Z",strokeLinecap:"round",strokeLinejoin:"round"})})}function De({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0",strokeLinecap:"round",strokeLinejoin:"round"})})}function Me({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V19a2 2 0 0 1-2 2",strokeLinecap:"round",strokeLinejoin:"round"})})}function Oe({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"currentColor",height:s,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{clipRule:"evenodd",d:"M10 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-7 9a7 7 0 1 1 14 0z",fillRule:"evenodd"})})}function ke({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"currentColor",height:s,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M13 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0m5 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0m-4 7a4 4 0 0 0-8 0v3h8zM6 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0m10 10v-3a6 6 0 0 0-.75-2.906A3.005 3.005 0 0 1 19 15v3zM4.75 12.094A6 6 0 0 0 4 15v3H1v-3a3 3 0 0 1 3.75-2.906"})})}function $e({height:s="1em",width:t="1em"}){return e.jsxs("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"m12 3 9 4.5-9 4.5-9-4.5z",fill:"#f8e7c0",strokeLinejoin:"round"}),e.jsx("path",{d:"m3 7.5 9 4.5v9l-9-4.5zM21 7.5 12 12v9l9-4.5z",fill:"#e2c48d",strokeLinejoin:"round"}),e.jsx("path",{d:"m12 3 9 4.5v9L12 21l-9-4.5v-9L12 3",strokeLinejoin:"round"})]})}function Ue({height:s="1em",width:t="1em"}){return e.jsxs("svg",{fill:"none",height:s,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:12,cy:12,r:10,stroke:"currentColor",strokeWidth:2}),e.jsx("circle",{cx:12,cy:12,fill:"currentColor",r:4}),e.jsx("g",{stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{d:"M12 12V2M12 12l8.142 5.071M12 12v10M12 12l-8.142 5.071"})})]})}function Ge({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 18 18 6M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})})}function ze({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0",strokeLinecap:"round",strokeLinejoin:"round"})})}function Je({height:s="1em",width:t="1em"}){return e.jsx("svg",{fill:"currentColor",height:s,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{clipRule:"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0m-7 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-1-9a1 1 0 0 0-1 1v4a1 1 0 1 0 2 0V6a1 1 0 0 0-1-1",fillRule:"evenodd"})})}function He({height:s="1em",width:t="1em"}){return e.jsxs("svg",{fill:"none",height:s,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M16.862 3.487a1.125 1.125 0 0 1 1.591 1.591l-9 9a1.125 1.125 0 0 1-.433.266L6 15l.656-2.976a1.125 1.125 0 0 1 .266-.433l9-9Z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19.5 10.5V18A2.25 2.25 0 0 1 17.25 20.25H6.75A2.25 2.25 0 0 1 4.5 18V6.75A2.25 2.25 0 0 1 6.75 4.5H14.25",strokeLinecap:"round",strokeLinejoin:"round"})]})}const te={coin:ye,visualize:Te,bookOpen:_e,menu:Ee,info:Ne,scroll:Le,map:Ae,inventory:Re,trash:De,log:Me,companion:Oe,nearbyNpc:ke,mapItemBox:$e,mapWheel:Ue,clock:ze,error:Je,x:Ge,journalPen:He},Fe=Object.keys(te);function k({name:s,size:t,color:o,inline:n=!1,marginRight:a,wrapper:l="span"}){const r=te[s],d=[n?"inline-block":"",o?{slate:"text-slate-400",gray:"text-gray-400",zinc:"text-zinc-400",neutral:"text-neutral-400",stone:"text-stone-400",red:"text-red-400",orange:"text-orange-400",amber:"text-amber-400",yellow:"text-yellow-400",lime:"text-lime-400",green:"text-green-400",emerald:"text-emerald-400",teal:"text-teal-400",cyan:"text-cyan-400",sky:"text-sky-400",blue:"text-blue-400",indigo:"text-indigo-400",violet:"text-violet-400",purple:"text-purple-400",fuchsia:"text-fuchsia-400",pink:"text-pink-400",rose:"text-rose-400",white:"text-white"}[o]:""].filter(Boolean).join(" "),h=a?{marginRight:a}:void 0;return l==="g"?e.jsx("g",{className:d,style:h,children:e.jsx(r,{height:t,width:t})}):e.jsx("span",{className:d,style:h,children:e.jsx(r,{height:t,width:t})})}k.defaultProps={color:void 0,inline:!1,marginRight:void 0,size:void 0,wrapper:"span"};function i({title:s,content:t,isJson:o=!0,maxHeightClass:n="overflow-auto max-h-60"}){const a=(()=>{if(t==null)return"N/A";if(typeof t=="string")return t;if(o)try{const l=F(t);if(s.toLowerCase().includes("parsed")){const r=m=>{m&&typeof m=="object"&&(delete m.observations,delete m.rationale,Object.values(m).forEach(r))};r(l)}return JSON.stringify(l,null,2)}catch(l){return console.error("Error stringifying debug content:",l,t),"Error stringifying JSON content."}return typeof t=="string"?t:JSON.stringify(t,null,2)})();return e.jsxs("section",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-sky-400 mb-1",children:s}),e.jsx("pre",{className:`bg-slate-900 p-2 rounded-md text-sm  font-mono text-white overflow-auto ${n} whitespace-pre-wrap break-words`,children:e.jsx("code",{children:a})})]})}i.defaultProps={isJson:!0,maxHeightClass:"overflow-auto max-h-60"};function Ve({npcs:s}){return e.jsx(i,{content:s,maxHeightClass:"max-h-[70vh]",title:"Current NPCs"})}const C=s=>{try{return JSON.parse(`"${s.replace(/"/g,'\\"')}"`)}catch{return s.replace(/\\n/g,`
`)}},A=s=>{if(!s)return"";const t=ee(s);try{const o=JSON.parse(t),n=a=>{a&&typeof a=="object"&&(delete a.observations,delete a.rationale,Object.values(a).forEach(n))};return n(o),JSON.stringify(o,null,2)}catch{return s.replace(/"?(observations|rationale)"?\s*:\s*"[^"\\]*(?:\\.[^"\\]*)*"\s*,?/gi,"").trim()}};function qe({debugPacket:s}){const[t,o]=c.useState("reqres"),n=c.useCallback(()=>{o("reqres")},[]),a=c.useCallback(()=>{o("insights")},[]),l=c.useCallback(()=>{o("prompt")},[]);return s!=null&&s.dialogueDebugInfo?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:n,preset:t==="reqres"?"sky":"slate",pressed:t==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:a,preset:t==="insights"?"sky":"slate",pressed:t==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:l,preset:t==="prompt"?"sky":"slate",pressed:t==="prompt",size:"sm",variant:"toggle"})]}),t==="reqres"?e.jsx(e.Fragment,{children:s.dialogueDebugInfo.turns.map((r,m)=>{const d=r.thoughts&&r.thoughts.length>0?r.thoughts.map(j=>`Narrator THOUGHTS: "${C(j)}"`).join(`
`):null,h=d?`${d}
${r.rawResponse}`:r.rawResponse;return e.jsxs("div",{className:"mb-2",children:[e.jsx(i,{content:r.prompt,isJson:!1,title:`Turn ${String(m+1)} Request`}),e.jsx(i,{content:h,isJson:!1,title:`Turn ${String(m+1)} Response`})]},r.prompt)})}):t==="insights"?e.jsxs(e.Fragment,{children:[s.dialogueDebugInfo.summaryThoughts&&s.dialogueDebugInfo.summaryThoughts.length>0?e.jsx(i,{content:s.dialogueDebugInfo.summaryThoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Dialogue Summary Thoughts"}):null,s.dialogueDebugInfo.summaryPrompt?e.jsx(i,{content:s.dialogueDebugInfo.summaryPrompt,isJson:!1,title:"Dialogue Summary Prompt"}):null,s.dialogueDebugInfo.summaryRawResponse?e.jsx(i,{content:s.dialogueDebugInfo.summaryRawResponse,isJson:!1,title:"Dialogue Summary Response"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.dialogueDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),s.dialogueDebugInfo.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.dialogueDebugInfo.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(s.dialogueDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):e.jsx("p",{className:"italic text-slate-300",children:"No Dialogue debug info captured."})}function Be({gameLog:s}){return e.jsx(i,{content:s,maxHeightClass:"max-h-[70vh]",title:"Current Game Log"})}function ne({currentState:s,onUndoTurn:t,onApplyGameState:o,previousState:n=void 0}){const[a,l]=c.useState(""),[r,m]=c.useState(null),d=c.useMemo(()=>{const v=Y(s);return delete v.lastDebugPacket,v},[s]),h=c.useMemo(()=>{if(!n)return;const v=Y(n);return delete v.lastDebugPacket,v},[n]);c.useEffect(()=>{l(JSON.stringify(d,null,2))},[d]);const j=c.useCallback(v=>{l(v.target.value),m(null)},[]),f=c.useCallback(()=>{const v=se(a);if(v){const x=F(v);x.inventory=x.inventory.map(g=>{var b;const u=s.inventory.find(I=>I.id===g.id);return u?{...g,chapters:(b=g.chapters)==null?void 0:b.map((I,y)=>{var w,E;return{...I,imageData:(E=(w=u.chapters)==null?void 0:w[y])==null?void 0:E.imageData}})}:g}),x.playerJournal=x.playerJournal.map((g,u)=>{var b;return{...g,imageData:(b=s.playerJournal[u])==null?void 0:b.imageData}}),o(x),m(null)}else m("Invalid JSON")},[a,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(p,{ariaLabel:"Undo last turn",disabled:!n||s.globalTurnNumber<=1,label:`Undo Turn (Global Turn: ${String(s.globalTurnNumber)})`,onClick:t,preset:"orange",size:"sm",variant:"compact"}),e.jsxs("div",{className:"my-2",children:[e.jsx("label",{className:"block text-sm text-amber-300 mb-1",htmlFor:"gameStateEdit",children:"Edit Game State"}),e.jsx("textarea",{className:"w-full p-2 bg-slate-900 text-white border border-slate-600 rounded-md text-sm min-h-[40em] font-mono",id:"gameStateEdit",onChange:j,value:a}),e.jsx(p,{ariaLabel:"Verify and apply edited game state",label:"Verify & Apply",onClick:f,preset:"green",size:"sm",variant:"compact"}),r?e.jsx("p",{className:"text-red-400 text-xs mt-1",children:r}):null]}),e.jsx(i,{content:d,maxHeightClass:"max-h-[30vh]",title:"Current Game State (Stack[0] - Top)"}),h?e.jsx(i,{content:h,maxHeightClass:"max-h-[30vh]",title:"Previous Game State (Stack[1] - Bottom)"}):null]})}ne.defaultProps={previousState:void 0};function We({debugPacket:s}){const[t,o]=c.useState(!0),[n,a]=c.useState("reqres"),l=c.useCallback(()=>{o(!0)},[]),r=c.useCallback(()=>{o(!1)},[]),m=c.useCallback(()=>{a("reqres")},[]),d=c.useCallback(()=>{a("insights")},[]),h=c.useCallback(()=>{a("prompt")},[]);return s!=null&&s.inventoryDebugInfo?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:m,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:d,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.inventoryDebugInfo.prompt,isJson:!1,title:"Inventory AI Request"}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show raw inventory response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show parsed inventory response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?e.jsx(i,{content:A(s.inventoryDebugInfo.rawResponse),isJson:!1,title:"Inventory AI Response Raw"}):e.jsx(i,{content:s.inventoryDebugInfo.parsedItemChanges,title:"Inventory AI Response Parsed"})]}):n==="insights"?e.jsxs(e.Fragment,{children:[s.inventoryDebugInfo.thoughts&&s.inventoryDebugInfo.thoughts.length>0?e.jsx(i,{content:s.inventoryDebugInfo.thoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Thoughts"}):null,s.inventoryDebugInfo.observations?e.jsx(i,{content:s.inventoryDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Observations"}):null,s.inventoryDebugInfo.rationale?e.jsx(i,{content:s.inventoryDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Rationale"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.inventoryDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),s.inventoryDebugInfo.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.inventoryDebugInfo.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(s.inventoryDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):e.jsx("p",{className:"italic text-slate-300",children:"No Inventory AI interaction debug packet captured."})}function Ye({debugPacket:s}){const[t,o]=c.useState(!0),[n,a]=c.useState("reqres"),l=c.useCallback(()=>{o(!0)},[]),r=c.useCallback(()=>{o(!1)},[]),m=c.useCallback(()=>{a("reqres")},[]),d=c.useCallback(()=>{a("insights")},[]),h=c.useCallback(()=>{a("prompt")},[]);return s!=null&&s.librarianDebugInfo?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:m,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:d,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.librarianDebugInfo.prompt,isJson:!1,title:"Librarian AI Request"}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show raw inventory response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show parsed inventory response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?e.jsx(i,{content:A(s.librarianDebugInfo.rawResponse),isJson:!1,title:"Librarian AI Response Raw"}):e.jsx(i,{content:s.librarianDebugInfo.parsedItemChanges,title:"Librarian AI Response Parsed"})]}):n==="insights"?e.jsxs(e.Fragment,{children:[s.librarianDebugInfo.thoughts&&s.librarianDebugInfo.thoughts.length>0?e.jsx(i,{content:s.librarianDebugInfo.thoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Thoughts"}):null,s.librarianDebugInfo.observations?e.jsx(i,{content:s.librarianDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Observations"}):null,s.librarianDebugInfo.rationale?e.jsx(i,{content:s.librarianDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Rationale"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.librarianDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),s.librarianDebugInfo.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.librarianDebugInfo.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(s.librarianDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):e.jsx("p",{className:"italic text-slate-300",children:"No Librarian AI interaction debug packet captured."})}function Xe({inventory:s}){return e.jsx(i,{content:s,maxHeightClass:"max-h-[70vh]",title:"Current Inventory"})}function Ke({debugPacket:s}){const[t,o]=c.useState(!0),[n,a]=c.useState("reqres"),l=c.useCallback(()=>{o(!0)},[]),r=c.useCallback(()=>{o(!1)},[]),m=c.useCallback(()=>{a("reqres")},[]),d=c.useCallback(()=>{a("insights")},[]),h=c.useCallback(()=>{a("prompt")},[]),j=s!=null&&s.timestamp?new Date(s.timestamp).toLocaleString():"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-300 mb-2",children:["Timestamp:",j]}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:m,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:d,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s==null?void 0:s.prompt,isJson:!1,title:"Last Storyteller AI Request"}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show raw response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show parsed response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?e.jsx(i,{content:s==null?void 0:s.rawResponseText,isJson:!1,title:"Storyteller AI Response Raw"}):e.jsx(i,{content:s==null?void 0:s.parsedResponse,title:"Storyteller AI Response Parsed "})]}):n==="insights"?s!=null&&s.storytellerThoughts&&s.storytellerThoughts.length>0?e.jsx(i,{content:s.storytellerThoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Storyteller Thoughts"}):null:e.jsxs(e.Fragment,{children:[e.jsx(i,{content:(s==null?void 0:s.systemInstruction)??"N/A",isJson:!1,title:"System Prompt"}),s!=null&&s.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(s.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]}),s!=null&&s.error?e.jsx(i,{content:s.error,isJson:!1,title:"Error During Storyteller AI Interaction"}):null]})}function Pe({mapData:s}){return e.jsx(i,{content:s,maxHeightClass:"max-h-[70vh]",title:"Current Map Data (Full)"})}function Ze({loreFacts:s}){const t=[...s].sort((o,n)=>n.tier-o.tier||n.createdTurn-o.createdTurn).map((o,n)=>`${String(n+1)}. (Tier ${String(o.tier)}) ${o.text}`).join(`
`);return e.jsx(i,{content:t,isJson:!1,maxHeightClass:"max-h-[70vh]",title:"Current Lore"})}function Qe({worldSheet:s}){return e.jsx(i,{content:s??"World sheet data is unavailable.",maxHeightClass:"max-h-[70vh]",title:"World Sheet"})}function es({heroSheet:s,heroBackstory:t}){return e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s??"Hero sheet data is unavailable.",title:"Hero Sheet"}),e.jsx(i,{content:t??"Hero backstory data is unavailable.",title:"Hero Backstory"})]})}function ss({storyArc:s}){return e.jsx(i,{content:s??"Story arc data is unavailable.",maxHeightClass:"max-h-[70vh]",title:"Story Arc"})}function ts({debugPacket:s}){const[t,o]=c.useState(!0),[n,a]=c.useState({}),[l,r]=c.useState("reqres"),m=c.useCallback(()=>{o(!0)},[]),d=c.useCallback(()=>{o(!1)},[]),h=c.useCallback(()=>{r("reqres")},[]),j=c.useCallback(()=>{r("insights")},[]),f=c.useCallback(()=>{r("prompt")},[]),v=c.useCallback(u=>()=>{a(b=>({...b,[u]:!0}))},[]),x=c.useCallback(u=>()=>{a(b=>({...b,[u]:!1}))},[]),g=s!=null&&s.timestamp?new Date(s.timestamp).toLocaleString():"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-300 mb-2",children:["Map Update related to interaction at:",g]}),s!=null&&s.mapUpdateDebugInfo?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:h,preset:l==="reqres"?"sky":"slate",pressed:l==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:j,preset:l==="insights"?"sky":"slate",pressed:l==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:f,preset:l==="prompt"?"sky":"slate",pressed:l==="prompt",size:"sm",variant:"toggle"})]}),l==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.mapUpdateDebugInfo.prompt,isJson:!1,title:"Cartographer AI Request"}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show raw map response",label:"Raw",onClick:m,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show parsed map response",label:"Parsed",onClick:d,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?e.jsx(i,{content:A(s.mapUpdateDebugInfo.rawResponse),isJson:!1,title:"Cartographer AI Response Raw"}):e.jsx(i,{content:s.mapUpdateDebugInfo.parsedPayload,title:"Cartographer AI Response Parsed"})]}):l==="insights"?e.jsxs(e.Fragment,{children:[s.mapUpdateDebugInfo.thoughts&&s.mapUpdateDebugInfo.thoughts.length>0?e.jsx(i,{content:s.mapUpdateDebugInfo.thoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Thoughts"}):null,s.mapUpdateDebugInfo.observations?e.jsx(i,{content:s.mapUpdateDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Observations"}):null,s.mapUpdateDebugInfo.rationale?e.jsx(i,{content:s.mapUpdateDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Rationale"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.mapUpdateDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),s.mapUpdateDebugInfo.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:s.mapUpdateDebugInfo.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(s.mapUpdateDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]}),s.mapUpdateDebugInfo.validationError?e.jsx(i,{content:s.mapUpdateDebugInfo.validationError,isJson:!1,title:"Map Update Validation Error"}):null,s.mapUpdateDebugInfo.minimalModelCalls?e.jsx(i,{content:s.mapUpdateDebugInfo.minimalModelCalls,title:"Minimal Model Calls"}):null,s.mapUpdateDebugInfo.connectorChainsDebugInfo&&s.mapUpdateDebugInfo.connectorChainsDebugInfo.length>0?s.mapUpdateDebugInfo.connectorChainsDebugInfo.map((u,b)=>e.jsxs("div",{className:"my-2",children:[l==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:u.prompt,isJson:!1,title:`Connector Chains Prompt (Round ${String(u.round)})`}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show raw connector chain response",label:"Raw",onClick:v(b),preset:n[b]??!0?"sky":"slate",pressed:n[b]??!0,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show parsed connector chain response",label:"Parsed",onClick:x(b),preset:n[b]??!0?"slate":"sky",pressed:!(n[b]??!0),size:"sm",variant:"toggle"})]}),n[b]??!0?u.rawResponse&&e.jsx(i,{content:A(u.rawResponse),isJson:!1,title:`Connector Chains Raw Response (Round ${String(u.round)})`}):u.parsedPayload&&e.jsx(i,{content:u.parsedPayload,title:`Connector Chains Parsed Payload (Round ${String(u.round)})`})]}):l==="insights"?e.jsxs(e.Fragment,{children:[u.thoughts&&u.thoughts.length>0?e.jsx(i,{content:u.thoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Thoughts (Round ${String(u.round)})`}):null,u.observations?e.jsx(i,{content:u.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Observations (Round ${String(u.round)})`}):null,u.rationale?e.jsx(i,{content:u.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Rationale (Round ${String(u.round)})`}):null]}):null,u.validationError?e.jsx(i,{content:u.validationError,isJson:!1,title:`Connector Chains Validation Error (Round ${String(u.round)})`}):null]},`chain-${String(u.round)}`)):null]}):e.jsx("p",{className:"italic text-slate-300",children:"No Map Update AI interaction debug packet captured for the last main AI turn."})]})}function ns({debugPacket:s,onDistillFacts:t}){const[o,n]=c.useState({}),[a,l]=c.useState("reqres"),r=c.useCallback(x=>()=>{n(g=>({...g,[x]:!0}))},[]),m=c.useCallback(x=>()=>{n(g=>({...g,[x]:!1}))},[]),d=c.useCallback(()=>{l("reqres")},[]),h=c.useCallback(()=>{l("insights")},[]),j=c.useCallback(()=>{l("prompt")},[]),f=(x,g)=>{if(!g)return null;const u=o[x]??!0;return e.jsx("div",{className:"mb-4",children:a==="reqres"?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:g.prompt,isJson:!1,title:`${x} Request`}),e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:`Show raw ${x} response`,label:"Raw",onClick:r(x),preset:u?"sky":"slate",pressed:u,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:`Show parsed ${x} response`,label:"Parsed",onClick:m(x),preset:u?"slate":"sky",pressed:!u,size:"sm",variant:"toggle"})]}),u?e.jsx(i,{content:A(g.rawResponse),isJson:!1,title:`${x} Response Raw`}):e.jsx(i,{content:g.parsedPayload,title:`${x} Response Parsed`})]}):a==="insights"?e.jsxs(e.Fragment,{children:[g.thoughts&&g.thoughts.length>0?e.jsx(i,{content:g.thoughts.map(C).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Thoughts`}):null,g.observations?e.jsx(i,{content:g.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Observations`}):null,g.rationale?e.jsx(i,{content:g.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Rationale`}):null]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{content:g.systemInstruction??"N/A",isJson:!1,title:`${x} System Prompt`}),g.jsonSchema?e.jsxs(e.Fragment,{children:[e.jsx(i,{content:g.jsonSchema,title:"Raw Schema"}),e.jsx(i,{content:L(g.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})},x)},v=s==null?void 0:s.loremasterDebugInfo;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(p,{ariaLabel:"Show request and response",label:"Req/Res",onClick:d,preset:a==="reqres"?"sky":"slate",pressed:a==="reqres",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show insights",label:"Insights",onClick:h,preset:a==="insights"?"sky":"slate",pressed:a==="insights",size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"Show system prompt",label:"Prompt",onClick:j,preset:a==="prompt"?"sky":"slate",pressed:a==="prompt",size:"sm",variant:"toggle"})]}),e.jsx(p,{ariaLabel:"Trigger distill mode",label:"Run Distill",onClick:t,preset:"purple",size:"sm",variant:"compact"}),v?e.jsxs(e.Fragment,{children:[f("Collect",v.collect),f("Extract",v.extract),f("Integrate",v.integrate),f("Distill",v.distill),f("Journal",v.journal)]}):e.jsx("p",{className:"italic text-slate-300",children:"No Loremaster AI interaction debug packet captured."})]})}function as({currentState:s}){const{lastTurnChanges:t}=s,o=t?{npcs:t.npcChanges.length,items:t.itemChanges.length,mapChanged:t.mapDataChanged,objAchieved:t.objectiveAchieved,mainQuestAchieved:t.mainQuestAchieved}:null;return e.jsx(i,{content:{currentMapNodeId:s.currentMapNodeId,currentObjective:s.currentObjective,themeName:s.theme.name,globalTurnNumber:s.globalTurnNumber,lastTurnChangesBrief:o,localEnvironment:s.localEnvironment,localPlace:s.localPlace,localTime:s.localTime,mainQuest:s.mainQuest,objectiveAnimationType:s.objectiveAnimationType,score:s.score},maxHeightClass:"max-h-[70vh]",title:"Miscellaneous State Values"})}function ae({mapData:s,travelPath:t}){if(!t||t.length===0)return e.jsx("p",{className:"italic text-slate-300",children:"No destination set."});const o=t.map(n=>{if(n.step==="node")return{step:"node",data:s.nodes.find(r=>r.id===n.id)??{id:n.id,missing:!0}};if(n.id.startsWith("hierarchy:")){const[l,r]=n.id.split(":")[1].split("->");return{step:"hierarchy",from:l,to:r}}return{step:"edge",data:s.edges.find(l=>l.id===n.id)??{id:n.id,missing:!0}}});return e.jsxs(e.Fragment,{children:[e.jsx(i,{content:t,title:"Travel Path (IDs)"}),e.jsx(i,{content:o,maxHeightClass:"max-h-[70vh]",title:"Expanded Path Data"})]})}ae.defaultProps={travelPath:null};const G=[...Ce],rs=[...Ie],os=[...Fe],X=H.filter(s=>!_.includes(s)&&s!=="glitching");function is(){const[s,t]=c.useState(new Set),o=c.useCallback(a=>()=>{t(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},[]),n=c.useCallback(()=>{},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Buttons"}),rs.map(a=>{const l=a==="toggle",r=a==="close",m=r?G.slice(0,1):G;return e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-slate-400 mb-1",children:a}),e.jsx("div",{className:`flex flex-wrap gap-1${r?" relative h-12":""}`,children:m.map(d=>{const h=`${String(a)}-${d}`;return e.jsx(p,{ariaLabel:h,icon:r?e.jsx(k,{name:"x",size:16}):void 0,label:r?void 0:d,onClick:l?o(h):n,preset:d,pressed:l?s.has(h):void 0,size:"sm",variant:a},h)})})]},a)})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Text Fields"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:G.slice(0,8).map(a=>e.jsx("input",{"aria-label":a,className:`p-2 rounded-md bg-${a}-700 text-${a}-200 border border-${a}-500`,placeholder:a,readOnly:!0},a))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Page Blocks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[_.map(a=>e.jsx("div",{className:`p-3 tag-${a} rounded-md`,children:a},a)),_.flatMap(a=>X.map(l=>e.jsx("div",{className:`p-3 tag-${a} tag-${l} rounded-md`,children:`${a} ${l}`},`${a}-${l}`)))]}),e.jsxs("div",{className:"space-y-3",children:[_.map(a=>e.jsx("div",{className:`p-3 tag-${a} tag-recovered rounded-md`,children:`${a} recovered`},`${a}-recovered`)),_.flatMap(a=>X.map(l=>e.jsx("div",{className:`p-3 tag-${a} tag-${l} tag-recovered rounded-md`,children:`${a} ${l} recovered`},`${a}-${l}-recovered`)))]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Icons"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:os.map(a=>e.jsxs("div",{className:"flex flex-col items-center text-slate-300",children:[e.jsx(k,{name:a,size:32}),e.jsx("span",{className:"text-xs mt-1",children:a})]},a))})]})]})}function ls({badFacts:s,debugLore:t,goodFacts:o,onClearFacts:n,onSaveFacts:a,onSimulateVictory:l,onToggleDebugLore:r,onTriggerMainQuestAchieved:m,onSpawnNpcAtLocation:d,onSpawnBook:h,onSpawnMap:j,onSpawnPicture:f,onSpawnPage:v,onSpawnVehicle:x}){const[g,u]=c.useState(!1),b=c.useCallback(()=>{u(w=>!w)},[]),I=c.useCallback(()=>{const w=JSON.stringify({goodFacts:o,badFacts:s},null,2);a(w)},[o,s,a]),y=c.useCallback(()=>{n()},[n]);return e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-sky-300 mb-2",children:"Tools"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(p,{ariaLabel:"Trigger main quest achieved",label:"Main Quest Achieved",onClick:m,preset:"purple",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Simulate victory",label:"Simulate Victory",onClick:l,preset:"green",size:"sm",variant:"compact"})]}),e.jsx("h3",{className:"text-base font-semibold text-amber-200 mb-2",children:"Spawn"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(p,{ariaLabel:"Spawn NPC at current location",label:"Spawn NPC (Here)",onClick:d,preset:"orange",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Spawn book in inventory",label:"Spawn Book",onClick:h,preset:"sky",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Spawn map in inventory",label:"Spawn Map",onClick:j,preset:"sky",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Spawn picture in inventory",label:"Spawn Picture",onClick:f,preset:"sky",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Spawn page in inventory",label:"Spawn Page",onClick:v,preset:"sky",size:"sm",variant:"compact"}),e.jsx(p,{ariaLabel:"Spawn vehicle in inventory",label:"Spawn Vehicle",onClick:x,preset:"sky",size:"sm",variant:"compact"})]}),e.jsx("h3",{className:"text-base font-semibold text-sky-200 mb-2",children:"Debug Lore"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(p,{ariaLabel:"Toggle Debug Lore",label:t?"Disable":"Enable",onClick:r,preset:"purple",pressed:t,size:"sm",variant:"toggle"}),e.jsx(p,{ariaLabel:"View collected facts",label:g?"Hide Facts":"View Facts",onClick:b,preset:"sky",size:"sm",variant:"compact"}),g?e.jsx(p,{ariaLabel:"Save facts to file",label:"Save JSON",onClick:I,preset:"green",size:"sm",variant:"compact"}):null,g?e.jsx(p,{ariaLabel:"Clear collected facts",label:"Clear Facts",onClick:y,preset:"red",size:"sm",variant:"compact"}):null]}),g?e.jsx(i,{content:{goodFacts:o,badFacts:s},title:"Collected Facts"}):null]})}function Dt({isVisible:s,onClose:t,debugPacket:o,gameStateStack:n,onUndoTurn:a,onApplyGameState:l,onTriggerMainQuestAchieved:r,onSimulateVictory:m,onSpawnNpcAtLocation:d,onSpawnBook:h,onSpawnMap:j,onSpawnPicture:f,onSpawnPage:v,onSpawnVehicle:x,travelPath:g,onDistillFacts:u,debugLore:b,onToggleDebugLore:I,goodFacts:y,badFacts:w,onSaveFacts:E,onClearFacts:V}){const[R,$]=c.useState("GameState"),U=c.useCallback(T=>()=>{$(T)},[]);if(!s)return null;const S=n[0],D=n[1],M=[{name:"GameState",label:"Game State"},{name:"MainAI",label:"Storyteller AI"},{name:"MapLocationAI",label:"Cartographer AI"},{name:"InventoryAI",label:"Inventory AI"},{name:"LibrarianAI",label:"Librarian AI"},{name:"LoremasterAI",label:"Loremaster AI"},{name:"DialogueAI",label:"Dialogue AI"},{name:"Inventory",label:"Inventory"},{name:"NPCs",label:"NPCs"},{name:"MapDataFull",label:"Map Data"},{name:"Lore",label:"Lore"},{name:"WorldSheet",label:"World Sheet"},{name:"HeroSheet",label:"Hero Sheet"},{name:"StoryArc",label:"Story Arc"},{name:"GameLog",label:"Game Log"},{name:"TravelPath",label:"Travel Path"},{name:"MiscState",label:"Misc State"},{name:"Playground",label:"Playground"},{name:"Tools",label:"Tools"}],re=()=>{switch(R){case"GameState":return e.jsx(ne,{currentState:S,onApplyGameState:l,onUndoTurn:a,previousState:D});case"MainAI":return e.jsx(Ke,{debugPacket:o});case"MapLocationAI":return e.jsx(ts,{debugPacket:o});case"InventoryAI":return e.jsx(We,{debugPacket:o});case"LibrarianAI":return e.jsx(Ye,{debugPacket:o});case"LoremasterAI":return e.jsx(ns,{debugPacket:o,onDistillFacts:u});case"DialogueAI":return e.jsx(qe,{debugPacket:o});case"Inventory":return e.jsx(Xe,{inventory:S.inventory});case"NPCs":return e.jsx(Ve,{npcs:S.allNPCs});case"MapDataFull":return e.jsx(Pe,{mapData:S.mapData});case"Lore":return e.jsx(Ze,{loreFacts:S.loreFacts});case"WorldSheet":return e.jsx(Qe,{worldSheet:S.WorldSheet});case"HeroSheet":return e.jsx(es,{heroBackstory:S.heroBackstory,heroSheet:S.heroSheet});case"StoryArc":return e.jsx(ss,{storyArc:S.storyArc});case"GameLog":return e.jsx(Be,{gameLog:S.gameLog});case"TravelPath":return e.jsx(ae,{mapData:S.mapData,travelPath:g});case"MiscState":return e.jsx(as,{currentState:S});case"Playground":return e.jsx(is,{});case"Tools":return e.jsx(ls,{badFacts:w,debugLore:b,goodFacts:y,onClearFacts:V,onSaveFacts:E,onSimulateVictory:m,onSpawnBook:h,onSpawnMap:j,onSpawnNpcAtLocation:d,onSpawnPage:v,onSpawnPicture:f,onSpawnVehicle:x,onToggleDebugLore:I,onTriggerMainQuestAchieved:r});default:return e.jsx("p",{children:"Select a tab"})}};return e.jsx("div",{"aria-labelledby":"debug-view-title","aria-modal":"true",className:"animated-frame open",role:"dialog",children:e.jsxs("div",{className:"animated-frame-content flex flex-col",children:[e.jsx(p,{ariaLabel:"Close debug view",icon:e.jsx(k,{name:"x",size:20}),onClick:t,size:"sm",variant:"close"}),e.jsx("h1",{className:"text-2xl font-bold text-amber-400 mb-3 text-center flex-shrink-0",id:"debug-view-title",children:"Debug View & Game Internals"}),e.jsx("div",{className:"flex flex-wrap border-b border-slate-700 mb-3 flex-shrink-0",children:M.map(T=>e.jsx(p,{ariaLabel:T.label,label:T.label,onClick:U(T.name),pressed:R===T.name,size:"sm",variant:"tab"},T.name))}),e.jsx("div",{className:"overflow-y-auto flex-grow p-1",children:re()})]})})}export{Nt as $,Lt as A,gt as B,ys as C,As as D,ot as E,gs as F,ps as G,at as H,rt as I,it as J,_ as K,Ns as L,Bs as M,xt as N,K as O,Z as P,H as Q,Ms as R,Xs as S,st as T,Et as U,de as V,Ks as W,pt as X,ue as Y,ge as Z,xe as _,ft as a,Q as a0,ht as a1,mt as a2,dt as a3,ut as a4,Rs as a5,le as a6,Qs as a7,At as a8,hs as a9,Is as aA,we as aB,Rt as aC,ks as aD,Vs as aE,Cs as aF,oe as aG,jt as aH,vt as aI,Dt as aJ,Fs as aK,_t as aa,Ct as ab,lt as ac,Ss as ad,P as ae,et as af,tt as ag,ws as ah,qs as ai,be as aj,$s as ak,Us as al,Ds as am,Gs as an,zs as ao,Js as ap,Hs as aq,_s as ar,Es as as,Ls as at,Ts as au,B as av,W as aw,Ys as ax,k as ay,p as az,It as b,wt as c,St as d,bt as e,nt as f,Ps as g,Ws as h,ds as i,ms as j,L as k,bs as l,us as m,js as n,vs as o,fs as p,xs as q,ct as r,F as s,Os as t,Zs as u,ie as v,he as w,Tt as x,yt as y,se as z};
